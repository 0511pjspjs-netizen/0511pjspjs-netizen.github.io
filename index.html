<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="google-adsense-account" content="ca-pub-5540625627003630">
<title>ì†Œì•„ ì •ìƒ í–‰ë™ ë°œë‹¬ í€´ì¦ˆ (v3.1 ì•ˆì •í™”)</title>
<style>
  :root{--brand:#2563eb;--bg:#f7f7fb;--card:#ffffff;--muted:#6b7280;--ok:#16a34a;--bad:#dc2626;--chip:#e5e7eb}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple Color Emoji,Noto Color Emoji,sans-serif;background:var(--bg);color:#111}
  header{background:var(--brand);color:#fff;padding:14px 16px;font-weight:700;text-align:center}
  main{max-width:980px;margin:18px auto;padding:0 12px}
  .card{background:var(--card);border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,.07);padding:18px}
  h2{margin:6px 0 14px}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .btn{border:0;border-radius:10px;background:var(--brand);color:#fff;padding:10px 14px;font-weight:600;cursor:pointer}
  .btn.secondary{background:#334155}
  .btn.ghost{background:#eef2ff;color:#1e3a8a}
  .btn.gray{background:#e5e7eb;color:#111}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:8px}
  .age{background:var(--chip);border:0;border-radius:10px;padding:10px 8px;font-weight:600;cursor:pointer}
  .age:hover{filter:brightness(.95)}
  .question{font-size:1.2rem;line-height:1.6;margin:6px 0 12px}
  .hint{color:var(--muted);font-size:.9rem}
  .feedback{margin-top:10px;padding:12px;border-radius:10px}
  .ok{background:#dcfce7;color:#065f46}
  .no{background:#fee2e2;color:#7f1d1d}
  .hidden{display:none !important}
  .section{margin-top:14px}
  .chips label{display:inline-flex;align-items:center;gap:6px;margin-right:14px}
  .chips input{width:18px;height:18px}
  .opts{margin-top:10px;padding:12px;background:#f3f4f6;border-radius:10px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border-top:1px solid #e5e7eb;padding:10px 8px;text-align:left;vertical-align:top}
  th{background:#f3f4f6}
  td.status{width:72px;text-align:center;font-weight:700}
  .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:#eef2ff;color:#1e3a8a;font-size:.82rem}
  .muted{color:#6b7280}
  textarea{width:100%;min-height:120px;padding:10px;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
  details>summary{cursor:pointer;margin:12px 0;font-weight:600}
  #completeBox{margin-top:12px;padding:16px;border-radius:12px;background:#eef2ff;color:#1e3a8a;text-align:center}
</style>
</head>
<body>
<header>ì†Œì•„ ì •ìƒ í–‰ë™ ë°œë‹¬ í€´ì¦ˆ</header>
<main>
  <!-- ì‹œì‘ í™”ë©´ -->
  <section id="start" class="card">
    <h2>ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
    <div class="chips section">
      <label><input type="checkbox" class="cat" value="ìš´ë™" checked>ìš´ë™</label>
      <label><input type="checkbox" class="cat" value="ì ì‘" checked>ì ì‘</label>
      <label><input type="checkbox" class="cat" value="ì–¸ì–´" checked>ì–¸ì–´</label>
      <label><input type="checkbox" class="cat" value="ì‚¬íšŒì  í–‰ë™" checked>ì‚¬íšŒì  í–‰ë™</label>
    </div>

    <div class="opts">
      <strong>ì¶œì œ ì˜µì…˜</strong><br/>
      <label style="display:block;margin-top:6px;"><input type="checkbox" id="optAfter28"> 28ì£¼ ì´í›„ë¡œë§Œ ì¶œì œ</label>
      <label style="display:block;margin-top:6px;"><input type="checkbox" id="optUnattemptedFirst"> í’€ì§€ ì•Šì€ ë¬¸ì œë¶€í„° ì¶œì œ</label>
      <label style="display:block;margin-top:6px;"><input type="checkbox" id="optWrongFirst"> í‹€ë¦° ë¬¸ì œ ìµíˆê¸°</label>
      <div class="hint" style="margin-top:6px;">â€» 'í’€ì§€ ì•Šì€ ë¬¸ì œ'ì™€ 'í‹€ë¦° ë¬¸ì œ' ì˜µì…˜ì€ ì„œë¡œ ë°°íƒ€ì ì…ë‹ˆë‹¤. í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ë‹¤ë¥¸ í•˜ë‚˜ê°€ ìë™ í•´ì œë©ë‹ˆë‹¤.</div>
    </div>

    <div class="row section">
      <button class="btn" id="startBtn">í€´ì¦ˆ ì‹œì‘</button>
      <button class="btn gray" id="reportBtn">ì •ì˜¤í‘œ ë³´ê¸°</button>
      <button class="btn ghost" id="manageBtn">ë°ì´í„° í¸ì§‘</button>
    </div>
    <p class="hint section">í‘œì˜ ë¬¸ì¥ì„ 1ê°œì”© ì €ì¥í•´ í€´ì¦ˆë¡œ ì œì‹œí•©ë‹ˆë‹¤. (ê¸°ë¡ì€ ì´ ê¸°ê¸°ì— ë³´ì¡´)</p>
  </section>

  <!-- í€´ì¦ˆ í™”ë©´ -->
  <section id="quiz" class="card hidden">
    <div class="row" style="justify-content:space-between;margin-bottom:6px">
      <div><span class="pill" id="qMeta"></span></div>
      <div class="row">
        <button class="btn gray" id="toStart">ì²˜ìŒ</button>
        <button class="btn gray" id="toReport">ì •ì˜¤í‘œ</button>
      </div>
    </div>
    <div id="qText" class="question">ë¬¸ì¥ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    <div id="completeBox" class="hidden">
      <div style="font-weight:700;">ğŸ‰ ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤!</div>
      <button class="btn gray" id="goHomeFromComplete" style="margin-top:10px;">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
    <div class="grid" id="ageGrid"></div>
    <div id="feedback" class="feedback hidden"></div>
    <div class="row section">
      <button class="btn" id="nextBtn">ë‹¤ìŒ ë¬¸ì œ</button>
    </div>
    <p class="hint">â€» ì¤‘ë³µ ì—†ì´ ì…”í”Œë˜ì–´ ì¶œì œë©ë‹ˆë‹¤.</p>
  </section>

  <!-- ì •ì˜¤í‘œ í™”ë©´ -->
  <section id="report" class="card hidden">
    <div class="row" style="justify-content:space-between">
      <h2>ì •ì˜¤í‘œ</h2>
      <div class="row">
        <button class="btn gray" id="backStart">ì²˜ìŒ</button>
        <button class="btn gray" id="resetMark">ì •ì˜¤í‘œ ì´ˆê¸°í™”</button>
        <button class="btn ghost" id="toggleWrongOnly">í‹€ë¦° í•­ëª©ë§Œ ë³´ê¸°</button>
      </div>
    </div>
    <div class="muted">ìµœê·¼ í’€ì´ ê²°ê³¼ê°€ ë°˜ì˜ë©ë‹ˆë‹¤. (O: ì •ë‹µ, X: ì˜¤ë‹µ, â€“: ë¯¸í’€ì´)</div>
    <table>
      <thead><tr><th>ì—°ë ¹</th><th>ì¹´í…Œê³ ë¦¬</th><th>ë¬¸ì¥</th><th class="status">ê²°ê³¼</th></tr></thead>
      <tbody id="reportBody"></tbody>
    </table>
  </section>

  <!-- ë°ì´í„° í¸ì§‘ê¸° -->
  <section id="manage" class="card hidden">
    <div class="row" style="justify-content:space-between">
      <h2>ë°ì´í„° í¸ì§‘ (ê´€ë¦¬ì)</h2>
      <div class="row">
        <button class="btn gray" id="backHome">ì²˜ìŒ</button>
        <button class="btn secondary" id="saveData">ì €ì¥</button>
      </div>
    </div>
    <p class="muted">ê° ì¹¸ì— â€œì—¬ëŸ¬ ë¬¸ì¥â€ì„ ë¶™ì—¬ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ í•œ ë¬¸ì¥ì”© ìª¼ê°œ ì €ì¥ë©ë‹ˆë‹¤. ì¤„ì„ ì§€ìš°ë©´ í•´ë‹¹ ë¬¸í•­ì´ ì‚­ì œë©ë‹ˆë‹¤.</p>
    <details>
      <summary>ì›ë³¸ ë°ì´í„° ë‚´ë³´ë‚´ê¸°/ë¶ˆëŸ¬ì˜¤ê¸°</summary>
      <div class="row">
        <button class="btn gray" id="importJson">JSON ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn gray" id="exportJson">JSON ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn gray" id="restoreOriginal">ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›</button>
        <button class="btn gray" id="wipeAll">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
      </div>
    </details>
    <div id="editor"></div>
  </section>

<!-- Google AdSense í•˜ë‹¨ ê´‘ê³  (ë°˜ì‘í˜•) -->
<div id="ad-footer" style="max-width:980px;margin:20px auto 32px;display:block;">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5540625627003630"
       crossorigin="anonymous"></script>
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-5540625627003630"
       data-ad-slot="6088782346"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>

</main>

<script>
// ---------- ìƒìˆ˜/ì´ˆê¸° ë°ì´í„° ----------
const AGE_ORDER=["~4ì£¼","4ì£¼","8ì£¼","12ì£¼","16ì£¼","28ì£¼","40ì£¼","12ê°œì›”","15ê°œì›”","18ê°œì›”","2ë…„","30ê°œì›”","3ë…„","4ë…„","5ë…„"];
const CATS=["ìš´ë™","ì ì‘","ì–¸ì–´","ì‚¬íšŒì  í–‰ë™"];
const LS_ITEMS="peds.items.v3.1",LS_RESULTS="peds.results.v1",LS_FILTERS="peds.filters.v1",LS_PREFS="peds.prefs.v2";

// ìµœì‹  ë°ì´í„°ì…‹ (ìš”ì•½)
const ORIGINAL=[
  {age:"~4ì£¼",category:"ìš´ë™",text:"íŒ”ë‹¤ë¦¬ë¥¼ êµ¬ë¶€ë¦¬ê³  ìˆë‹¤."},
  {age:"~4ì£¼",category:"ìš´ë™",text:"Moro ë°˜ì‚¬, íŒŒì•… ë°˜ì‚¬ê°€ í™œë°œí•˜ë‹¤."},
  {age:"~4ì£¼",category:"ì ì‘",text:"ì–¼êµ´ì´ë‚˜ ë¶ˆë¹›ì„ ì‘ì‹œí•œë‹¤."},
  {age:"~4ì£¼",category:"ì–¸ì–´",text:"ëª©ì†Œë¦¬ì— ë°˜ì‘ì„ ë³´ì¸ë‹¤."},
  {age:"~4ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ì‚¬ëŒì˜ ì–¼êµ´ì„ ì„ í˜¸í•œë‹¤."},
  {age:"4ì£¼",category:"ìš´ë™",text:"ì—ì–´ ë†“ìœ¼ë©´ í„±ì„ ë“¤ê³ , ë¨¸ë¦¬ë¥¼ ì¢Œìš°ë¡œ ëŒë¦°ë‹¤."},
  {age:"4ì£¼",category:"ìš´ë™",text:"ê¸´ì¥ì„± ê²½ë°˜ì‚¬ì˜ ìì„¸ë¡œ ëˆ„ì›Œ ìˆë‹¤."},
  {age:"4ì£¼",category:"ì ì‘",text:"ì‚¬ë¬¼ì„ ì³ë‹¤ë³¸ë‹¤."},
  {age:"4ì£¼",category:"ì ì‘",text:"ì›€ì§ì´ëŠ” ë¬¼ì²´ë¥¼ ë”°ë¼ ë³¸ë‹¤."},
  {age:"4ì£¼",category:"ì–¸ì–´",text:"ë¯¸ì†Œì§“ê¸° ì‹œì‘í•œë‹¤."},
  {age:"4ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ëª©ì†Œë¦¬ì— ë°˜ì‘í•˜ì—¬ ëª¸ì„ ì›€ì°”ê±°ë¦°ë‹¤."},
  {age:"8ì£¼",category:"ìš´ë™",text:"ì—ì–´ ë°°ë¥¼ ë°›ì³ ë“¤ì–´ì˜¬ë¦¬ë©´ ë¨¸ë¦¬ë¥¼ ëª¸ê³¼ ìˆ˜í‰ì´ ë˜ë„ë¡ ë“ ë‹¤."},
  {age:"8ì£¼",category:"ìš´ë™",text:"ê¸´ì¥ì„± ê²½ë°˜ì‚¬ì˜ ìì„¸ë¡œ ëˆ„ì›Œ ìˆë‹¤."},
  {age:"8ì£¼",category:"ì ì‘",text:"ì›€ì§ì´ëŠ” ë¬¼ì²´ë¥¼ 180Â°ê¹Œì§€ ë”°ë¼ ë³¸ë‹¤."},
  {age:"8ì£¼",category:"ì–¸ì–´",text:"ë‹¤ë¥¸ ì‚¬ëŒì˜ ëª©ì†Œë¦¬ë¥¼ ë“£ê³  ìì‹ ì˜ ëª©ì†Œë¦¬ë¥¼ ë‚¸ë‹¤."},
  {age:"8ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ì£¼ìœ„ì˜ ìê·¹ì— ë°˜ì‘í•˜ì—¬ ë¯¸ì†Œì§“ëŠ”ë‹¤."},
  {age:"12ì£¼",category:"ìš´ë™",text:"ì—ì–´ ë†“ìœ¼ë©´ ë¨¸ë¦¬ì™€ ê°€ìŠ´ì„ ë“ ë‹¤."},
  {age:"12ì£¼",category:"ìš´ë™",text:"íŒ”ì„ í´ê³  ìˆëŠ”ë‹¤."},
  {age:"12ì£¼",category:"ìš´ë™",text:"ì—ì–´ ë°°ë¥¼ ë°›ì³ ë“¤ì–´ì˜¬ë¦¬ë©´ ë¨¸ë¦¬ë¥¼ ëª¸ ìœ„ì¹˜ë³´ë‹¤ ë†’ê²Œ ë“¤ì–´ì˜¬ë¦°ë‹¤."},
  {age:"12ì£¼",category:"ìš´ë™",text:"ë¨¸ë¦¬ë¥¼ ì•½ê°„ ê°€ëˆˆë‹¤."},
  {age:"12ì£¼",category:"ì ì‘",text:"ë¬¼ì²´ë¥¼ ë³´ë©´ ì ‘ê·¼í•˜ì§€ë§Œ ì¡ì§€ëŠ” ëª»í•œë‹¤."},
  {age:"12ì£¼",category:"ì ì‘",text:"ì¥ë‚œê°ì„ ë³´ë©´ ì†ì„ í”ë“ ë‹¤."},
  {age:"12ì£¼",category:"ì–¸ì–´",text:"ìŒì•… ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì¸ë‹¤."},
  {age:"12ì£¼",category:"ì–¸ì–´",text:"ì•„~ ì†Œë¦¬ë¥¼ ë‚¸ë‹¤."},
  {age:"12ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ì‚¬íšŒì  ë°˜ì‘ ì‹œê°„ì´ ê¸¸ì–´ì§„ë‹¤."},
  {age:"16ì£¼",category:"ìš´ë™",text:"ì—ì–´ ë†“ìœ¼ë©´ ë¨¸ë¦¬ì™€ ê°€ìŠ´ì„ ë“¤ì–´ ë¨¸ë¦¬ë¥¼ ìˆ˜ì§ìœ¼ë¡œ ë“ ë‹¤."},
  {age:"16ì£¼",category:"ìš´ë™",text:"ë‹¤ë¦¬ë¥¼ í´ê³  ìˆëŠ”ë‹¤."},
  {age:"16ì£¼",category:"ìš´ë™",text:"ë¨¸ë¦¬ë¥¼ ê°€ìš´ë°ë¡œ í•˜ê³  ëŒ€ì¹­ ìì„¸ë¡œ ëˆ„ì›ŒìˆëŠ”ë‹¤."},
  {age:"16ì£¼",category:"ìš´ë™",text:"ë°”ë¡œ ëˆ„ìš´ ìì„¸ì—ì„œ ë¶™ì¡ì•„ ì¼ìœ¼ì¼œ ì•‰íˆë©´ ë¨¸ë¦¬ë¥¼ ê°€ëˆˆë‹¤."},
  {age:"16ì£¼",category:"ì ì‘",text:"ë¬¼ì²´ì— ì†ì„ ë»—ì–´ ì¡ê³  ì…ì„ ê°€ì ¸ê°„ë‹¤."},
  {age:"16ì£¼",category:"ì ì‘",text:"ì‘ì€ ë¬¼ì²´ë¥¼ ë³´ê¸°ë§Œ í•˜ê³  ì¡ì§€ëŠ” ì•ŠëŠ”ë‹¤."},
  {age:"16ì£¼",category:"ì–¸ì–´",text:"í¬ê²Œ ì†Œë¦¬ ë‚´ì–´ ì›ƒëŠ”ë‹¤."},
  {age:"16ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ë¨¹ì„ ê²ƒì„ ë³´ë©´ ì¢‹ì•„í•œë‹¤."},
  {age:"28ì£¼",category:"ìš´ë™",text:"ë’¤ì§‘ëŠ”ë‹¤."},
  {age:"28ì£¼",category:"ìš´ë™",text:"ì•‰í˜€ ë†“ìœ¼ë©´ í˜¼ì ì•‰ì•„ ìˆëŠ”ë‹¤."},
  {age:"28ì£¼",category:"ìš´ë™",text:"ë°°ë°€ì´ë¥¼ í•œë‹¤. ë˜ëŠ” ë„¤ë°œë¡œ ê¸´ë‹¤."},
  {age:"28ì£¼",category:"ìš´ë™",text:"ì„¸ìš°ë©´ ë‹¤ë¦¬ë¥¼ ë»—ì–´ ëª¸ì„ ì§€íƒ±í•œë‹¤."},
  {age:"28ì£¼",category:"ì ì‘",text:"ë¬¼ê±´ì„ ë‹¤ë¥¸ ì†ìœ¼ë¡œ ë¬¼ê±´ì„ ì˜®ê²¨ ì¥”ë‹¤."},
  {age:"28ì£¼",category:"ì ì‘",text:"ì‘ì€ ë¬¼ì²´ë¥¼ ë³´ë©´ ê°ˆê³ ë¦¬ ëª¨ì–‘ìœ¼ë¡œ ì›€ì¼œì¥”ë‹¤."},
  {age:"28ì£¼",category:"ì–¸ì–´",text:"ì—¬ëŸ¬ ìŒì ˆì˜ ëª¨ìŒ ì†Œë¦¬ë¥¼ ë‚¸ë‹¤."},
  {age:"28ì£¼",category:"ì–¸ì–´",text:"ì˜ë¯¸ ì—†ì´ ì¬ì˜ê±°ë¦°ë‹¤."},
  {age:"28ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ì—„ë§ˆë¥¼ ë” ì¢‹ì•„í•œë‹¤."},
  {age:"28ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ê±°ìš¸ì„ ì¢‹ì•„í•œë‹¤."},
  {age:"28ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"ìƒëŒ€ì˜ ê°ì •ë³€í™”ì— ë°˜ì‘ì„ ë³´ì¸ë‹¤."},
  {age:"40ì£¼",category:"ìš´ë™",text:"í˜¼ì ì¼ì–´ë‚˜ ì•‰ëŠ”ë‹¤."},
  {age:"40ì£¼",category:"ìš´ë™",text:"ê¸°ì–´ ë‹¤ë‹Œë‹¤."},
  {age:"40ì£¼",category:"ìš´ë™",text:"ë¶™ì¡ê³  ì¼ì–´ë‚œë‹¤."},
  {age:"40ì£¼",category:"ìš´ë™",text:"ê°€êµ¬ ë“±ì„ ë¶™ì¡ê³  ê±·ëŠ”ë‹¤."},
  {age:"40ì£¼",category:"ì ì‘",text:"ì—„ì§€ì†ê°€ë½ê³¼ ê²€ì§€ì†ê°€ë½ì„ ì‚¬ìš©í•œë‹¤."},
  {age:"40ì£¼",category:"ì ì‘",text:"ì†ìˆ˜ê±´ ë°‘ì— ê°ì¶”ë©´ ì°¾ì•„ë‚¸ë‹¤."},
  {age:"40ì£¼",category:"ì–¸ì–´",text:"ë°˜ë³µë˜ëŠ” ììŒ ë°œìŒì„ í•œë‹¤."},
  {age:"40ì£¼",category:"ì–¸ì–´",text:"ì´ë¦„ì„ ë¶€ë¥´ë©´ ë°˜ì‘ì„ í•œë‹¤."},
  {age:"40ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"'ê¹Œê¿' ë†€ì´ë¥¼ í•œë‹¤."},
  {age:"40ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"'ì§ì§œê¿'ì„ í•œë‹¤."},
  {age:"40ì£¼",category:"ì‚¬íšŒì  í–‰ë™",text:"'ë°”ì´ë°”ì´'ë¥¼ í•œë‹¤."},
  {age:"12ê°œì›”",category:"ìš´ë™",text:"í˜¼ì ì¼ì–´ì„ ë‹¤."},
  {age:"12ê°œì›”",category:"ìš´ë™",text:"í˜¼ì ê±·ëŠ”ë‹¤."},
  {age:"12ê°œì›”",category:"ì ì‘",text:"ì•Œì•½ í¬ê¸°ì˜ ì‘ì€ ë¬¼ê±´ì„ ì—„ì§€ì™€ ê²€ì§€ë§Œìœ¼ë¡œ ì§‘ëŠ”ë‹¤."},
  {age:"12ê°œì›”",category:"ì ì‘",text:"ë‹¬ë¼ê³  í•œë‹¤ë©´ ì†ì— ë“  ë¬¼ê±´ì„ ìŠ¤ìŠ¤ë¡œ í´ì„œ ë†“ëŠ”ë‹¤."},
  {age:"12ê°œì›”",category:"ì–¸ì–´",text:"'ë§ˆë§ˆ' 'ë¹ ë¹ ' ë§ê³  ë‹¤ë¥¸ ë§ ëª‡ ê°œ ì •ë„ ë§í•œë‹¤."},
  {age:"12ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ê°„ë‹¨í•œ ê³µë†€ì´ë¥¼ í•œë‹¤."},
  {age:"12ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ì˜·ì„ ì…ì„ ë•Œ ìì„¸ë¥¼ ë§ì¶˜ë‹¤."},
  {age:"15ê°œì›”",category:"ìš´ë™",text:"í˜¼ì 'ì˜' ê±·ëŠ”ë‹¤."},
  {age:"15ê°œì›”",category:"ìš´ë™",text:"ì¸µê³„ë¥¼ ê¸°ì–´ ì˜¬ë¼ê°„ë‹¤."},
  {age:"15ê°œì›”",category:"ì ì‘",text:"ì¢…ì´ì— ê·¸ë¦¬ëŠ” ì‹œëŠ‰ì„ í•œë‹¤."},
  {age:"15ê°œì›”",category:"ì ì‘",text:"ì…ë°©ì²´ë¥¼ 2ê°œ ìŒ“ì•„ ì˜¬ë¦°ë‹¤."},
  {age:"15ê°œì›”",category:"ì–¸ì–´",text:"ì¹œìˆ™í•œ ë¬¼ê±´ì˜ ì´ë¦„ì„ ë§í•œë‹¤. (ex. ê³µ)"},
  {age:"15ê°œì›”",category:"ì–¸ì–´",text:"ëœ»ì„ ì•Œ ìˆ˜ ì—†ëŠ” ë§ì„ ì§€ê»„ì¸ë‹¤."},
  {age:"15ê°œì›”",category:"ì–¸ì–´",text:"ê°„ë‹¨í•œ í•œ ê°€ì§€ ì§€ì‹œëŠ” ë§ê²Œ ìˆ˜í–‰í•œë‹¤."},
  {age:"15ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ì›í•˜ëŠ” ê²ƒì„ ì†ê°€ë½ìœ¼ë¡œ ê°€ë¦¬í‚¤ë©° ë‹¬ë¼ê³  í•œë‹¤."},
  {age:"18ê°œì›”",category:"ìš´ë™",text:"í•œ ì†ì„ ì¡ê³  ì¸µê³„ë¥¼ ì˜¬ë¼ê°„ë‹¤."},
  {age:"18ê°œì›”",category:"ìš´ë™",text:"ì„œíˆ´ê²Œ ë›´ë‹¤."},
  {age:"18ê°œì›”",category:"ì ì‘",text:"ì…ë°©ì²´ë¥¼ 4ê°œë¥¼ ìŒ“ì•„ ì˜¬ë¦°ë‹¤."},
  {age:"18ê°œì›”",category:"ì ì‘",text:"í˜ë ¤ì“°ê¸°, ìˆ˜ì§ì„ ì„ í‰ë‚´ ë‚´ë©° ê·¸ë¦°ë‹¤."},
  {age:"18ê°œì›”",category:"ì ì‘",text:"ë³‘ì„ ê±°ê¾¸ë¡œ í•˜ì—¬ ì‘ì€ ë¬¼ì²´ë¥¼ êº¼ë‚¸ë‹¤."},
  {age:"18ê°œì›”",category:"ì–¸ì–´",text:"ì‹ ì²´ ë¶€ìœ„ë¥¼ 1ê°œ ì´ìƒ ì•Œê³  ë§í•œë‹¤."},
  {age:"18ê°œì›”",category:"ì–¸ì–´",text:"10ê°œ ì •ë„ì˜ ë‹¨ì–´ë¥¼ ë§í•œë‹¤."},
  {age:"18ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"í˜¼ì ë¨¹ëŠ”ë‹¤."},
  {age:"18ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ì†Œë³€ì„ ë³´ê³  ì•Œë ¤ ì¤€ë‹¤."},
  {age:"18ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ë¶€ëª¨ì—ê²Œ ì…ì„ ì˜¤ë¯€ë ¤ì„œ ë½€ë½€í•œë‹¤."},
  {age:"18ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ë¬¸ì œê°€ ìˆìœ¼ë©´ ë„ì›€ì„ ìš”ì²­í•œë‹¤."},
  {age:"2ë…„",category:"ìš´ë™",text:"ì˜ ë›´ë‹¤."},
  {age:"2ë…„",category:"ìš´ë™",text:"ì¸µê³„ë¥¼ í•œ ë²ˆì— í•œ ê³„ë‹¨ì”© ì˜¤ë¥´ë‚´ë¦°ë‹¤."},
  {age:"2ë…„",category:"ì ì‘",text:"ì…ë°©ì²´ë¥¼ 6~7ê°œ ìŒ“ì•„ ì˜¬ë¦°ë‹¤."},
  {age:"2ë…„",category:"ì ì‘",text:"ìˆ˜í‰ ì§ì„ ì„ ì¢…ì´ì— í‰ë‚´ë‚´ì–´ ê·¸ë¦°ë‹¤."},
  {age:"2ë…„",category:"ì–¸ì–´",text:"ê°„ë‹¨í•œ ë¬¸ì¥ì„ ë§í•œë‹¤."},
  {age:"2ë…„",category:"ì–¸ì–´",text:"ê·¸ë¦¼ì±…ì„ ì½ì–´ì£¼ë©´ ê·€ê¸°ìš¸ì—¬ ë“£ëŠ”ë‹¤."},
  {age:"2ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ê°„ë‹¨í•œ ì˜·ì„ í˜¼ì ë²—ëŠ”ë‹¤."},
  {age:"2ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ìˆŸê°€ë½ì§ˆì„ í•œë‹¤."},
  {age:"30ê°œì›”",category:"ìš´ë™",text:"í•œ ë°œì”© ë²ˆê°ˆì•„ ë”›ìœ¼ë©° ê³„ë‹¨ ì˜¤ë¥¸ë‹¤."},
  {age:"30ê°œì›”",category:"ì ì‘",text:"ì…ë°©ì²´ë¥¼ 9ê°œ ìŒ“ì•„ ì˜¬ë¦°ë‹¤."},
  {age:"30ê°œì›”",category:"ì ì‘",text:"ìˆ˜í‰, ìˆ˜ì§ ì§ì„ ì„ 'ë³´ê³ ' ê·¸ë¦°ë‹¤."},
  {age:"30ê°œì›”",category:"ì–¸ì–´",text:"ìì‹ ì„ ëŒ€ëª…ì‚¬ 'ë‚˜'ë¡œ í‘œí˜„í•œë‹¤."},
  {age:"30ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"ë¬¼ê±´ ì¹˜ìš°ê¸°ë¥¼ ë•ëŠ”ë‹¤."},
  {age:"30ê°œì›”",category:"ì‚¬íšŒì  í–‰ë™",text:"í‰ë‚´ë‚´ê¸° ë†€ì´ë¥¼ í•œë‹¤."},
  {age:"3ë…„",category:"ìš´ë™",text:"ì„¸ë°œìì „ê±°ë¥¼ íƒ„ë‹¤."},
  {age:"3ë…„",category:"ìš´ë™",text:"í•œ ë°œë¡œ ì ê¹ ì„¤ ìˆ˜ ìˆë‹¤."},
  {age:"3ë…„",category:"ì ì‘",text:"ì…ë°©ì²´ 3ê°œë¡œ ë‹¤ë¦¬ ëª¨ì–‘ì„ ë§Œë“ ë‹¤."},
  {age:"3ë…„",category:"ì ì‘",text:"ì›ì„ ë³´ê³  ê·¸ë¦°ë‹¤."},
  {age:"3ë…„",category:"ì–¸ì–´",text:"ì´ë¦„Â·ì„±ë³„Â·ë‚˜ì´ë¥¼ ë§í•œë‹¤."},
  {age:"3ë…„",category:"ì–¸ì–´",text:"ì…‹ê¹Œì§€ ì„¼ë‹¤."},
  {age:"3ë…„",category:"ì–¸ì–´",text:"ì²˜ìŒ ë³´ëŠ” ì‚¬ëŒë„ ì•Œì•„ë“¤ì„ ìˆ˜ ìˆë‹¤."},
  {age:"3ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ì˜·ì…ê¸°ì— í˜‘ì¡°í•œë‹¤. (ë‹¨ì¶” í’€ê¸°, ì‹ ë°œì„ ì‹ ëŠ”ë‹¤.)"},
  {age:"3ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ì†ì„ ì”»ëŠ”ë‹¤."},
  {age:"4ë…„",category:"ìš´ë™",text:"í•œ ë°œë¡œ ë›´ë‹¤."},
  {age:"4ë…„",category:"ìš´ë™",text:"ê°€ìœ„ì§ˆë¡œ ê·¸ë¦¼ ì˜¤ë ¤ ë‚¸ë‹¤."},
  {age:"4ë…„",category:"ì ì‘",text:"ì‚¬ê°í˜•ì„ ë³´ê³  ê·¸ë¦°ë‹¤."},
  {age:"4ë…„",category:"ì ì‘",text:"ì‚¬ëŒ ê·¸ë¦¼ì—ì„œ ë¨¸ë¦¬ ì™¸ì— ëª¸ì˜ 2~4 ë¶€ë¶„ì„ ê·¸ë¦´ ìˆ˜ ìˆë‹¤."},
  {age:"4ë…„",category:"ì ì‘",text:"ì‹­ì ëª¨ì–‘ì„ ë³´ê³  ê·¸ë¦°ë‹¤."},
  {age:"4ë…„",category:"ì ì‘",text:"ë‘ ì„  ì¤‘ ë” ê¸´ ê²ƒì„ ê°€ë ¤ë‚¼ ìˆ˜ ìˆë‹¤."},
  {age:"4ë…„",category:"ì–¸ì–´",text:"ì „ì¹˜ì‚¬ë¥¼ ì•ˆë‹¤."},
  {age:"4ë…„",category:"ì–¸ì–´",text:"ë„·ê¹Œì§€ ì„¼ë‹¤."},
  {age:"4ë…„",category:"ì–¸ì–´",text:"ë°˜ëŒ€ë§ì„ ì•ˆë‹¤."},
  {age:"4ë…„",category:"ì–¸ì–´",text:"ì¤„ê±°ë¦¬ê°€ ìˆëŠ” ë§ì„ í•œë‹¤."},
  {age:"4ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ì¹œêµ¬ì™€ í˜‘ì¡°ì ìœ¼ë¡œ í•¨ê»˜ ë…¼ë‹¤."},
  {age:"4ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"í˜¼ì ìš©ë³€ì„ í•´ê²°í•œë‹¤."},
  {age:"4ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ì–‘ì¹˜ì§ˆ í•œë‹¤."},
  {age:"4ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ì„¸ìˆ˜ë¥¼ í•œë‹¤."},
  {age:"5ë…„",category:"ìš´ë™",text:"í•œ ë°œì”© ë²ˆê°ˆì•„ ë“¤ê³  ë›´ë‹¤."},
  {age:"5ë…„",category:"ìš´ë™",text:"ì¤„ë„˜ê¸°ë¥¼ í•œë‹¤."},
  {age:"5ë…„",category:"ì ì‘",text:"ì‚¼ê°í˜• ë³´ê³  ê·¸ë¦°ë‹¤."},
  {age:"5ë…„",category:"ì ì‘",text:"ë¨¸ë¦¬ ì™¸ 6ë¶€ë¶„ì„ ê·¸ë¦°ë‹¤."},
  {age:"5ë…„",category:"ì ì‘",text:"ë‘˜ ì¤‘ ë¬´ê±°ìš´ ê²ƒì„ ê°€ë¦´ ìˆ˜ ìˆë‹¤."},
  {age:"5ë…„",category:"ì–¸ì–´",text:"ì—´ê¹Œì§€ ì„¼ë‹¤."},
  {age:"5ë…„",category:"ì–¸ì–´",text:"4ê°€ì§€ ìƒ‰ì„ ì•Œê³  ë§í•œë‹¤."},
  {age:"5ë…„",category:"ì–¸ì–´",text:"ë‹¨ì–´ì˜ ì˜ë¯¸ë¥¼ ë¬»ëŠ”ë‹¤."},
  {age:"5ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"í˜¼ì ì˜·ì„ ì…ê³  ë²—ëŠ”ë‹¤."},
  {age:"5ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ì†Œê¿‰ ë†€ì´ë¥¼ í•œë‹¤."},
  {age:"5ë…„",category:"ì‚¬íšŒì  í–‰ë™",text:"ë‹¤ë¥¸ ì•„ì´ì™€ ê²½ìŸì ì¸ ë†€ì´ë¥¼ í•œë‹¤."},
];

// ---------- ìœ í‹¸ ----------
const $=s=>document.querySelector(s);
const $$=s=>Array.from(document.querySelectorAll(s));
const uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);
function shuffle(a){const x=a.slice();for(let i=x.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[x[i],x[j]]=[x[j],x[i]];}return x;}
// (Safari êµ¬ë²„ì „ í˜¸í™˜) ë¬¸ì¥ ë¶„ë¦¬: lookbehind ë¯¸ì‚¬ìš©
function splitSentences(t){
  if(!t) return [];
  const c=t.replace(/\s+/g,' ').trim();
  if(!c) return [];
  const withMarks=c.replace(/([.!?])\s+/g,'$1|');
  return withMarks.split('|').map(s=>s.trim()).filter(Boolean);
}

// ---------- ì €ì¥ì†Œ ----------
function loadItems(){try{const r=localStorage.getItem(LS_ITEMS);return r?JSON.parse(r):[]}catch{return[]}}
function saveItems(a){localStorage.setItem(LS_ITEMS,JSON.stringify(a))}
function loadResults(){try{const r=localStorage.getItem(LS_RESULTS);return r?JSON.parse(r):{}}catch{return{}}}
function saveResults(o){localStorage.setItem(LS_RESULTS,JSON.stringify(o))}
function loadFilters(){try{const r=localStorage.getItem(LS_FILTERS);return r?JSON.parse(r):{"ìš´ë™":true,"ì ì‘":true,"ì–¸ì–´":true,"ì‚¬íšŒì  í–‰ë™":true}}catch{return{"ìš´ë™":true,"ì ì‘":true,"ì–¸ì–´":true,"ì‚¬íšŒì  í–‰ë™":true}}}
function saveFilters(f){localStorage.setItem(LS_FILTERS,JSON.stringify(f))}
function loadPrefs(){try{const r=localStorage.getItem(LS_PREFS);return r?JSON.parse(r):{after28:false,unattemptedFirst:false,wrongFirst:false}}catch{return{after28:false,unattemptedFirst:false,wrongFirst:false}}}
function savePrefs(p){localStorage.setItem(LS_PREFS,JSON.stringify(p))}

// ---------- ìƒíƒœ ----------
let ITEMS=loadItems();
if(ITEMS.length===0){ITEMS=ORIGINAL.map(o=>({id:uid(),...o}));saveItems(ITEMS);}
let RESULTS=loadResults();
let FILTERS=loadFilters();
let PREFS=loadPrefs();
let REPORT_WRONG_ONLY = false; // ì •ì˜¤í‘œ: í‹€ë¦° í•­ëª©ë§Œ ë³´ê¸° í† ê¸€
// ì¶”ê°€ ìƒíƒœ í”Œë˜ê·¸: ì¡°ê±´ë‚´ ë¬¸í•­ì´ ì—†ì„ ë•Œ 1íšŒ ëœë¤ ë¼ìš´ë“œ ê°•ì œ
let FORCE_ROUND = false;
let ROUND_USED = new Set();


// ---------- í™”ë©´ ì „í™˜ ----------
function mountStart(){
  $("#start").classList.remove("hidden"); $("#quiz").classList.add("hidden"); $("#report").classList.add("hidden"); $("#manage").classList.add("hidden");
  $$(".cat").forEach(cb=>{ cb.checked=!!FILTERS[cb.value]; cb.onchange=()=>{FILTERS[cb.value]=cb.checked;saveFilters(FILTERS);} });
  $("#optAfter28").checked = !!PREFS.after28;
  $("#optUnattemptedFirst").checked = !!PREFS.unattemptedFirst;
  $("#optWrongFirst").checked = !!PREFS.wrongFirst;
  const un = $("#optUnattemptedFirst"), wr=$("#optWrongFirst");
  un.onchange = e=>{ if(e.target.checked){ wr.checked=false; PREFS.wrongFirst=false; } PREFS.unattemptedFirst=e.target.checked; savePrefs(PREFS); };
  wr.onchange = e=>{ if(e.target.checked){ un.checked=false; PREFS.unattemptedFirst=false; } PREFS.wrongFirst=e.target.checked; savePrefs(PREFS); };
  $("#optAfter28").onchange = e=>{ PREFS.after28=e.target.checked; savePrefs(PREFS); };
}
function mountQuiz(){ $("#start").classList.add("hidden"); $("#quiz").classList.remove("hidden"); $("#report").classList.add("hidden"); $("#manage").classList.add("hidden"); }
function mountReport(){ $("#start").classList.add("hidden"); $("#quiz").classList.add("hidden"); $("#report").classList.remove("hidden"); $("#manage").classList.add("hidden"); updateWrongToggleLabel(); renderReport(); }
function mountManage(){ $("#start").classList.add("hidden"); $("#quiz").classList.add("hidden"); $("#report").classList.add("hidden"); $("#manage").classList.remove("hidden"); renderEditor(); }

// ---------- í€´ì¦ˆ ----------
let QUEUE=[],CURR=null;
const AGE_GRID=$("#ageGrid"); AGE_GRID.innerHTML="";
AGE_ORDER.forEach(a=>{const b=document.createElement("button");b.className="age";b.textContent=a;b.onclick=()=>pickAge(a);AGE_GRID.appendChild(b);});

function ageFilterAfter28(list){
  if(!PREFS.after28) return list;
  const idx28 = AGE_ORDER.indexOf("28ì£¼");
  return list.filter(it => AGE_ORDER.indexOf(it.age) >= idx28);
}
function activeItems(){
  const act=CATS.filter(c=>FILTERS[c]);
  return ITEMS.filter(i=>act.includes(i.category));
}
function buildQueue(){
  let pool = ageFilterAfter28(activeItems());
  if(pool.length===0){ QUEUE=[]; CURR=null; return; }

  const wrong = pool.filter(it => RESULTS[it.id]==="X");
  const unattempted = pool.filter(it => RESULTS[it.id]===undefined);
  const correct = pool.filter(it => RESULTS[it.id]==="O");

  if(PREFS.wrongFirst){
    if(wrong.length===0){ QUEUE=[]; CURR=null; return; }
    QUEUE = shuffle(wrong);
    CURR = QUEUE[0] || null;
    return;
  }else if(PREFS.unattemptedFirst){
    if(unattempted.length===0){ QUEUE=[]; CURR=null; return; }
    QUEUE = [...shuffle(unattempted), ...shuffle(correct), ...shuffle(wrong)];
    CURR = QUEUE[0] || null;
    return;
  }else{
    if(FORCE_ROUND){
      const remaining = pool.filter(it => !ROUND_USED.has(it.id));
      if(remaining.length===0){ QUEUE=[]; CURR=null; return; }
      QUEUE = shuffle(remaining);
      CURR = QUEUE[0] || null;
      return;
    }
    const allAttempted = pool.every(it => RESULTS[it.id] !== undefined);
    if(allAttempted){ QUEUE=[]; CURR=null; return; }
    QUEUE = shuffle(pool);
    CURR = QUEUE[0] || null;
    return;
  }
}
function showCompletion(){
  $("#qText").textContent="";
  $("#ageGrid").classList.add("hidden");
  $("#completeBox").classList.remove("hidden");
  $("#feedback").classList.add("hidden");
  $("#nextBtn").disabled=true;
}
function showQuestion(){
  if(!CURR){ showCompletion(); return; }
  if(FORCE_ROUND && CURR){ ROUND_USED.add(CURR.id); }
  $("#completeBox").classList.add("hidden");
  $("#ageGrid").classList.remove("hidden");
  $("#nextBtn").disabled=false;
  $("#qText").textContent=CURR.text;
  $("#qMeta").textContent=`ì¹´í…Œê³ ë¦¬: ${CURR.category}`;
  $("#feedback").classList.add("hidden");
}
function pickAge(a){
  if(!CURR) return;
  const ok=(a===CURR.age);
  RESULTS[CURR.id]=ok?"O":"X"; saveResults(RESULTS);
  const fb=$("#feedback"); fb.className="feedback "+(ok?"ok":"no");
  fb.textContent= ok?`ì •ë‹µ! (${CURR.age})`:`ì˜¤ë‹µâ€¦ ì •ë‹µì€ ${CURR.age}`;
  fb.classList.remove("hidden");
}
function nextQuestion(){
  if(!CURR){ return; }
  if(QUEUE.length<=1){
    buildQueue(); showQuestion(); return;
  }
  QUEUE.shift(); CURR=QUEUE[0]; showQuestion();
}

// ---------- ì •ì˜¤í‘œ ----------
function updateWrongToggleLabel(){
  const btn = document.getElementById("toggleWrongOnly");
  if(!btn) return;
  btn.textContent = REPORT_WRONG_ONLY ? "ì „ì²´ ë³´ê¸°" : "í‹€ë¦° í•­ëª©ë§Œ ë³´ê¸°";
}

function renderReport(){
  const tbody=$("#reportBody"); tbody.innerHTML="";
  const list=ITEMS.slice().sort((a,b)=>AGE_ORDER.indexOf(a.age)-AGE_ORDER.indexOf(b.age));
  const filtered = REPORT_WRONG_ONLY ? list.filter(it => RESULTS[it.id]==="X") : list;
  if(filtered.length===0){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td colspan="4" class="muted">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td>`;
    tbody.appendChild(tr);
    return;
  }
  filtered.forEach(it=>{
    const tr=document.createElement("tr");
    const st=RESULTS[it.id]||"â€“";
    tr.innerHTML=`<td>${it.age}</td><td>${it.category}</td><td>${it.text}</td><td class="status">${st}</td>`;
    tbody.appendChild(tr);
  });
}

// ---------- í¸ì§‘ê¸° ----------
function renderEditor(){
  const host=$("#editor"); host.innerHTML="";
  AGE_ORDER.forEach(age=>{
    const title=document.createElement("h3"); title.textContent=age; host.appendChild(title);
    const grid=document.createElement("div"); grid.className="grid"; host.appendChild(grid);
    CATS.forEach(cat=>{
      const cell=document.createElement("div"); cell.className="card"; cell.style.padding="12px";
      const label=document.createElement("div"); label.innerHTML=`<strong>${cat}</strong> <span class="muted">(ì—¬ëŸ¬ ë¬¸ì¥ ë¶™ì—¬ë„£ê¸°Â·ìˆ˜ì •Â·ì‚­ì œ ê°€ëŠ¥)</span>`;
      const ta=document.createElement("textarea"); ta.dataset.age=age; ta.dataset.cat=cat;
      ta.value = ITEMS.filter(i=>i.age===age&&i.category===cat).map(i=>i.text).join("\n");
      cell.appendChild(label); cell.appendChild(ta); grid.appendChild(cell);
    });
  });
}
function saveFromEditor(){
  const next=[];
  $$("#editor textarea").forEach(ta=>{
    const age=ta.dataset.age, cat=ta.dataset.cat;
    let lines=splitSentences(ta.value);
    if(lines.length===0){ lines=ta.value.split(/\n+/).map(s=>s.trim()).filter(Boolean); }
    lines.forEach(t=>{
      const prev=ITEMS.find(p=>p.age===age&&p.category===cat&&p.text===t);
      next.push({id:prev?.id||uid(), age, category:cat, text:t});
    });
  });
  ITEMS=next; saveItems(ITEMS); alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); renderEditor();
}
function importJson(){
  const raw=prompt("JSON ë°°ì—´(Item[])ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì˜ˆ: [{\"age\":\"12ê°œì›”\",\"category\":\"ìš´ë™\",\"text\":\"í˜¼ì ê±·ëŠ”ë‹¤.\"}, ...]");
  if(!raw) return;
  try{
    const arr=JSON.parse(raw);
    if(!Array.isArray(arr)) throw new Error("ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
    ITEMS=arr.map(o=>({id:o.id||uid(),age:o.age,category:o.category,text:o.text}));
    saveItems(ITEMS); renderEditor(); alert("ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.");
  }catch(e){ alert("ì‹¤íŒ¨: "+e.message); }
}
function exportJson(){
  const blob=new Blob([JSON.stringify(ITEMS,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob); const a=document.createElement("a");
  a.href=url; a.download="peds_items.json"; a.click(); URL.revokeObjectURL(url);
}
function restoreOriginal(){
  if(!confirm("ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›í• ê¹Œìš”? (í˜„ì¬ í¸ì§‘ ë‚´ìš©ì€ ë®ì–´ì”ë‹ˆë‹¤)")) return;
  ITEMS=ORIGINAL.map(o=>({id:uid(),...o})); saveItems(ITEMS); renderEditor(); alert("ì›ë³¸ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.");
}
function wipeAll(){
  if(!confirm("ëª¨ë“  ë°ì´í„°(ë¬¸í•­/ì •ì˜¤í‘œ)ë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
  ITEMS=[]; saveItems(ITEMS); RESULTS={}; saveResults(RESULTS); renderEditor(); alert("ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
}

// ---------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ----------
document.getElementById("startBtn").onclick=()=>{
  $$(".cat").forEach(cb=>FILTERS[cb.value]=cb.checked); saveFilters(FILTERS);
  PREFS.after28 = document.getElementById("optAfter28").checked;
  PREFS.unattemptedFirst = document.getElementById("optUnattemptedFirst").checked;
  PREFS.wrongFirst = document.getElementById("optWrongFirst").checked;
  savePrefs(PREFS);

  FORCE_ROUND = false;
  ROUND_USED = new Set();

  const act = ageFilterAfter28(activeItems());
  if(act.length===0){alert("ì„ íƒí•˜ì‹  ì¹´í…Œê³ ë¦¬/ì˜µì…˜ì— í•´ë‹¹í•˜ëŠ” ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.");return;}

  mountQuiz();
  buildQueue();
  if(!CURR){
    alert("ì„ íƒí•˜ì‹  ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ëœë¤ìœ¼ë¡œ í€´ì¦ˆë¥¼ ë„ì›ë‹ˆë‹¤.");
    PREFS.unattemptedFirst = false; PREFS.wrongFirst = false; savePrefs(PREFS);
    FORCE_ROUND = true;
    ROUND_USED = new Set();
    buildQueue();
  }
  showQuestion();
};
document.getElementById("reportBtn").onclick=()=>mountReport();
document.getElementById("manageBtn").onclick=()=>mountManage();

document.getElementById("toStart").onclick=()=>mountStart();
document.getElementById("toReport").onclick=()=>mountReport();
document.getElementById("nextBtn").onclick=()=>nextQuestion();
document.getElementById("goHomeFromComplete").onclick=()=>mountStart();

document.getElementById("backStart").onclick=()=>mountStart();
document.getElementById("resetMark").onclick=()=>{if(confirm("ì •ì˜¤í‘œ(O/X) ê¸°ë¡ì„ ëª¨ë‘ ì§€ìš¸ê¹Œìš”?")){RESULTS={};saveResults(RESULTS);renderReport();}};

document.getElementById("toggleWrongOnly").onclick=()=>{ REPORT_WRONG_ONLY = !REPORT_WRONG_ONLY; updateWrongToggleLabel(); renderReport(); };

document.getElementById("backHome").onclick=()=>mountStart();
document.getElementById("saveData").onclick=()=>saveFromEditor();
document.getElementById("importJson").onclick=()=>importJson();
document.getElementById("exportJson").onclick=()=>exportJson();
document.getElementById("restoreOriginal").onclick=()=>restoreOriginal();
document.getElementById("wipeAll").onclick=()=>wipeAll();

// ---------- ë¶€íŒ… ----------
mountStart();
</script>
</body>
</html>
